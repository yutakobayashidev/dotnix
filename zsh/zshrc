#!/usr/bin/env zsh

# ========================================
# Main zsh configuration
# ========================================

# "do" alias breaks for/do/done keywords on re-source
unalias do 2>/dev/null

# home-manager session variables
HM_SESSION_VARS="$HOME/.local/state/home-manager/gcroots/current-home/home-path/etc/profile.d/hm-session-vars.sh"
if [ -f "$HM_SESSION_VARS" ]; then
  . "$HM_SESSION_VARS"
fi

# Enable completion
autoload -Uz compinit && compinit

# git-wt
eval "$(git wt --init zsh)"

# ========================================
# Load config files
# ========================================

# oh-my-zsh configuration (must be loaded first)
source ~/.config/zsh/config/oh-my-zsh.zsh

# zsh plugins
source ~/.zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.zsh
source ~/.zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh
source ~/.zsh/plugins/fzf-tab/fzf-tab.plugin.zsh

# zoxide (must be after oh-my-zsh to avoid cd being overwritten)
eval "$(zoxide init zsh --cmd cd)"

# direnv (must be last to avoid spurious unloading messages)
eval "$(direnv hook zsh)"

# ========================================
# Load functions
# ========================================

for func in ~/.config/zsh/functions/*.zsh; do
  source "$func"
done

# aliases (must be after functions loop â€” "do" alias breaks for/do/done)
source ~/.config/zsh/config/aliases.zsh
