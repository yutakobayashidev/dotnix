name: "Update Flake Inputs (Stable)"

on:
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:
    inputs:
      minimum-release-age-days:
        description: "Minimum release age in days before updating"
        required: false
        type: number
        default: 3
      skip-delay:
        description: "Skip the minimum release age check for all inputs"
        required: false
        type: boolean
        default: false

jobs:
  update:
    uses: ./.github/workflows/_update-flake-reusable.yaml
    with:
      exclude-inputs: "llm-agents"
      minimum-release-age-days: ${{ github.event.inputs.minimum-release-age-days && github.event.inputs.minimum-release-age-days || '3' }}
      skip-delay: ${{ github.event.inputs.skip-delay == 'true' }}
    secrets:
      app-id: ${{ secrets.FLAKE_UPDATER_APP_ID }}
      private-key: ${{ secrets.FLAKE_UPDATER_APP_PRIVATE_KEY }}
      cachix-auth-token: ${{ secrets.CACHIX_AUTH_TOKEN }}
